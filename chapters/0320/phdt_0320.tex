\input{../0000_chapter_draft_boilerplate/phdt_0000_draft_boilerplate.tex}

\begin{document}

\setcounter{chapter}{2}
\linespread{0.75}
\chapter{The Earth crust as sensed by inverse modelling of the gravity field}
\linespread{1} % reset to value in preamble

\setcounter{section}{1}
\section{Signal isolation: data reduction and uncertainty budget}
\label{s:SigIs}

\subsection*{Summary}
\label{ss:SigIs:Summary}
In order to perform geophysical inversions on the static gravity field, a signal separation procedure is required, i.e.~the effect of an a-priori mass distribution must be removed, isolating an anomalous field \parencites[e.g.][]{Tenzer2012}{Sjoberg2013}[][and references therein]{Tenzer2009}.
The observed field stripped of the forward-modelled attraction of these ``known masses'' constitutes the input of inverse gravity modelling.
Any distribution of anomalous masses that results in the isolated field is a solution to the inverse problem.
Common reductions include the well-known terrain correction, i.e.~landmasses and bathymetry \parencites{Hinze2003}{Hinze2005}, which can be further refined by stripping the effect of subsurface density variations \parencite{Vajda2008}.

Uncertainties in the a-priori masses, such as unmodelled spatial variability in density, accumulate in the reductions and are propagated to the reduced data and to the inversion results.
Incomplete and inexact geological knowledge cannot be avoided, thus a perfect data reduction is unrealistic.
Therefore, an uncertainty-aware signal isolation process, i.e.~a process providing error estimates alongside its reduced gravity data, is a necessary step in estimating confidence of the inversion results, in statistical terms.
Error information is required in order to perform multi-observable integrated modelling \parencite[e.g.][]{Afonso2013}, comparisons \parencite[e.g.][]{Root2017}, or assimilation of geophysical models \parencites[e.g.~to assemble large scale maps from local studies, see][]{Tesauro2008}{Grad2009}{Molinari2011}.

The procedure and experiments described in this chapter were designed for local Moho inverse modelling, using global satellite-only gravity field models.
They were applied in the gravity-constrained thermal modelling strategy described in this thesis.
They include corrections for the terrain effect (topography, water, and ice), sediments and other intra-crustal density variations, far-field effects of crustal roots, and inhomogeneities in the lithospheric- and upper-mantle.
Particular attention was paid to ensure spectral consistency between the forward-modelled reductions and the input gravity models.

Uncertainty was quantified through Monte Carlo error propagation \parencite{Aster2018}, resulting in a population of randomly perturbed reduction fields (according to a set of parameter uncertainty assumptions) and of inverted crust-mantle boundary depths.
Results include the probability density function of these reductions and of the inverted results, from which derived descriptive statistics were computed (e.g.~the spatial distribution of a defined confidence interval).

% The adjective ``anomalous'' is commonly used to indicate deviations from an a-priori reference. In order to prevent confusion with the strict-sense ``anomaly'', a gravity functional, in this section the term \textit{residual} is used to refer to any gravity data after the signal isolation procedure.
\newpage

\subsection{Definition and computation of data reductions}
\label{ss:SigIs:Defs}
% teoria, definizioni, metodo SH e confronti con tesseroids

\subsubsection{No-topography gravity disturbance}
\label{sss:SigIs:Defs:NETC}
In order to isolate the gravitational signal due to an unknown mass distribution, a technique known as ``stripping'' is employed \parencites{Vajda2008}{Tenzer2009}.
It consists in computing the gravitational effect of a ``known mass'' model, as inferred by other investigations, and removing it from the observed signal.
The gravimetric inverse problem is therefore formulated in terms of an anomalous gravity field resulting from the enquired mass/density distribution.

Following the recommendations in \textcite{Hackney2003} and \textcite{Vajda2007}, the formulation hereby presented is based on gravity disturbances, to avoid the ``Secondary Indirect Topographic Effect'' that arises when the topographic correction is applied to gravity anomalies.
Recalling the definition of gravity disturbance from \textcite{HofmannWellenhof2006}, section~2.12: it is defined as the difference in magnitude between the observed gravity vector $\bm{g}$ and the normal gravity vector $\bm{\gamma}$, at the same point $P$ of geocentric geodetic coordinates $(h, \lambda, \phi)$:
\begin{equation}
    \label{eq:red:GravDist}
    \delta g (h, \lambda, \phi) =
    \lvert \bm{g}(h, \lambda, \phi) \rvert -
    \lvert \bm{\gamma}(h, \lambda, \phi) \rvert
\end{equation}
where $\bm{g}$ is the gradient of the potential $\nabla W$ and $\bm{\gamma}$ is the gradient of the normal potential $\nabla U$.
This follows from the definition of normal and disturbing potential, respectively $U$ and $T$:
\begin{equation}
    \label{eq:red:Pot}
    W(h, \lambda, \phi) = U(h, \lambda) + T(h, \lambda, \phi)
\end{equation}
in which $W$ and $U$ can be decomposed in an attraction (gravitational) and a centrifugal component each, denoted with $\Phi$ \parencite[Eq.~5 and 13 in][]{Barthelmes2013}.
\begin{equation}
    \label{eq:red:PotAttr}
    \underbrace{W_{a}(h, \lambda, \phi) + \Phi(h, \lambda)}_W =
    \underbrace{U_{a}(h, \lambda) + \Phi(h, \lambda)}_U +
    T(h, \lambda, \phi)
\end{equation}
By ``geocentric geodetic coordinates'' we refer to ``ellipsoidal coordinates'' \parencite{HofmannWellenhof2006}, with $h$ ellipsoidal height, $\phi$ geodetic latitude, and $\lambda$ geodetic longitude.

To isolate the contribution of the anomalous density distribution we must remove the effect of a reference density model, against which anomalous densities are referred (in terms of density contrasts).
Following the strategy of \textcite{Vajda2006}, we can define a reference density model composed of two regions: one inside the reference ellipsoid, such as to generate the external normal potential, and one between the reference ellipsoid and the ``ellipsoidal topography'', i.e. the ``topography reckoned from the ellipsoid''.
As demonstrated by them, the gravity disturbance obtained by removing the effect of such a reference model is rigorously related with the ``gravitational attraction of the anomalous density distribution inside the entire Earth'' \parencite{Vajda2006}.
Omitting most of the derivation, for which I refer the reader to the contents in \textcite{Vajda2006}, I report here the following decomposition of the attraction potential $W_a$:
\begin{equation}
    \label{eq:red:Vdec1}
    W_a(h, \lambda, \phi) = V^{E}(h, \lambda, \phi) + V^{ET}(h, \lambda, \phi)
\end{equation}
where $V^{E}$ is the normal potential ($U_a$ in Eq.~\ref{eq:red:PotAttr}), due to the masses inside the reference ellipsoid, and $V^{ET}$ is the potential due to the masses between the ellipsoid and the topography.
Each of the potentials in Eq.~\ref{eq:red:Vdec1} is further decomposed, in the contribution of a reference density and in the contribution of the anomalous density distribution (in respect to the chosen reference). Therefore, omitting the position arguments ($h, \lambda, \phi$), the following is obtained:
\begin{equation}
    \label{eq:red:Vdec2}
    W_a = V_{R}^{E} + \delta V^{E} + V_{R}^{ET} + \delta V^{ET}
\end{equation}
where the terms with the subscript $R$ ($V_{R}^{E}$ and $V_{R}^{ET}$) denote the potentials due to the reference density contribution and the terms preceded by $\delta$ ($\delta V^{E}$ and $\delta V^{ET}$) denote the potentials due to the anomalous density contribution.
Recalling that $W_a - V_{R}^{E}$ (equivalent to $W_a - U_a$) is the disturbing potential $T$, Eq.~\ref{eq:red:Vdec2} can thus be rewritten as:
\begin{equation}
    \label{eq:red:DistT1}
    T = \left( \delta V^{E} + \delta V^{ET} \right) + V_{R}^{ET}
\end{equation}
The sum of $\delta V^{E}$ and $ \delta V^{ET}$ is the potential of the anomalous density distribution in the whole Earth $\delta V$, so the Eq.~\ref{eq:red:DistT1} can be further rearranged to:
\begin{equation}
    \label{eq:red:DistT2}
    T - V_{R}^{ET} = \delta V
\end{equation}

\Textcite{Vajda2006} proposed the notation $T^{NETC}$ for $T - V_{R}^{ET}$, the {NETC} acronym standing for ``No Ellipsoidal Topography of Constant density''.
Taking the vertical derivative of $T^{NETC}$ (applying the differential operator $-\partial / \partial h$, along the ellipsoidal normal), the ``NETC gravity disturbance'' is obtained:
\begin{equation}
    \label{eq:red:DistgNETC1}
    \delta_{g}^{NETC} =
    -\frac{\partial T^{NETC}}{\partial h} =
    -\frac{\partial \delta V}{\partial h} \equiv \delta A
\end{equation}
where $\delta A$ is the attraction of the anomalous density distribution.
The NETC gravity disturbance can be computed for each point gravity disturbance $\delta g$ using the following:
\begin{equation}
    \label{eq:red:DistgNETC2}
    \delta_{g}^{NETC} = \delta_{g} - A_{R}^{ET}
\end{equation}
here $A_{R}^{ET}$ is the forward-modelled attraction of the Earth topography of reference density.

The process that has been just described is conceptually akin to computing and removing a ``complete Bouguer correction'' \parencites{Hinze2003}{Mikuska2006} to gravity observations.
There are, however, some methodological discrepancies in the various definitions.
The method and terminology hereby presented should prevent confusion, providing a gravity quantity ($\delta_{g}^{NETC}$) which is formally related to the unmodelled density distribution, i.e. the component that was not accounted for in the reference model.
\newpage

\subsubsection{Corrections to the gravity disturbance}
\label{sss:SigIs:Defs:Corrs}
Following the definitions used by \textcite{Vajda2008} and \textcite{Tenzer2009}, we classify the corrections to the gravity disturbance as topographic, bathymetric, and stripping.
They are fundamentally further refinements to the reference density model.
The topographic correction is computed with a reference density for both solid and liquid topography, i.e. for the strict sense topographic surface of land masses and for the surface of water bodies, both in respect to the reference ellipsoid.
The bathymetric correction consists in the removal of the effect of water density, expressed as contrast against the reference topographic density.
All further corrections (e.g. ice, sediments, crustal and mantle inhomogeneities...) go under the name of stripping -- they are computed as contrasts against reference, similarly to the bathymetric correction \parencite{Hammer1963}.

In regard to the masses below the reference ellipsoid, the reference densities are the ones of a model which results in the adopted normal potential, in concordance with the normal potential decomposition of Eq.~\ref{eq:red:Vdec1}.
A radially-stratified model of the interior (actually made up of concentric ellipsoidal shells), such as the PREM \parencite[Preliminary Reference Earth Model,][]{Dziewonski1981}, should satisfy this condition \parencite{Tscherning1981}.

Stripping a set of \textit{known masses} (i.e. a-priori density distribution models) is often aimed at signal isolation.
For example, \textit{mantle gravity anomalies} \parencites[e.g.][]{Mooney2010}{Kaban2014} are obtained by stripping the ``crustal effect'', i.e. by correcting for a crust model \parencite[e.g. {CRUST1.0},][]{Laske2012Crust10}.
Starting from the NETC gravity disturbance introduced in the previous section (\ref{sss:SigIs:Defs:NETC}), corrections can be applied for ice, sediments, crustal heterogeneities.
The disturbance obtained after those corrections equals to a model Earth without topography above the ellipsoid and a reference-density (\textit{normal}) crust inside the ellipsoid, down to the crust-mantle interface.
In the unlikely case we had a perfect density model for these above-Moho masses, this reduced gravity would be equal to the attraction of anomalous densities in the mantle and core.

% discarding the following, shorter paragraph afterwards
% An application example is the work by \textcite{Tenzer2009}, who compiled and presented a set of global maps of the gravity disturbance --obtained from the EGM08 global gravity model \parencite{Pavlis2012EGM2008}-- corrected for the {CRUST2.0} model \parencite{Bassin2000Crust20} and for a reference crust of constant density.
% They chose the density of the latter in order to minimise the correlation between the crust-reduced disturbance and the Moho depth.
% By doing so, they obtained a global best-decorrelation density contrast of the ``consolidated crust'' (i.e. the bulk value) of \SI{-520}{\kilo \gram \per \metre \squared}, against the reference ellipsoid.
% This results in a stripped disturbance containing ideally no-topography, a \SI{3190}{\kilo \gram \per \metre \squared} crust between the ellipsoid surface and the Moho interface ($\num{2670} + \num{520}$), and the attraction of the density inhomogeneities below the Moho.
% It should be noted that there is no requirement of decorrelation between the crustal gravity signal and the one resulting from mantle inhomogeneities.

The work by \textcite{Tenzer2009} is an example of a similar application: they compiled and presented a set of global maps of the gravity disturbance (obtained from the EGM08 global gravity model, \cite{Pavlis2012EGM2008})-- corrected for the {CRUST2.0} model \parencite{Bassin2000Crust20}.
They also provided a crust reduction not depending on a-priori density models, using a decorrelation analysis between the crust--reduced disturbance and the Moho undulations.

\Textcite{Tenzer2009} also provided a global map of ellipsoid-- versus geoid--referenced topography and bathymetry corrected gravity disturbance.
Differences reach upwards to $\pm~14$~\si{\milli Gal} over continents, with a morphology highly correlated to geoidal undulations, as expected.

In crustal thickness modelling, signal isolation is obtained by concurrently correcting for above- and below-Moho masses ---as it has been done to obtain the global model {GEMMA} \parencites{Reguzzoni2013}{Reguzzoni2015}.
Global crustal density models \parencites[e.g.][]{Laske2012Crust10}{Pasyanos2014} rely mostly on seismological data, therefore requiring strong assumptions on velocity-density conversions \parencite[e.g.][]{Sebera2018}.
Mantle stripping is less constrained, since there are no readily available density models \parencite{Tenzer2015}.
Conversion from velocity models \parencites[e.g.][]{Simmons2010}{Schaeffer2013} require modelling the concurring effect of temperature, pressure and composition on the elastic parameter --- which means carrying out comprehensive thermodynamic modelling \parencites{Connolly2005}{Connolly2009}.
These issues area dealt in detail in section~\ref{ss:SigIs:InModels}.

\subsection{Forward modelling method}
\label{ss:SigIs:Fwd}

\subsubsection{Spectral--domain forward modelling}
\label{sss:SigIs:Fwd:SHfwd}
Forward modelling the gravity field resulting from a mass distribution involves integrating its gravitational effects, thus evaluating the so called \textit{Newton integral} \parencite{HofmannWellenhof2006}:
\begin{equation}
    \label{eq:SHfwd:NewtonInt}
    W = G \iiint_v \frac{\rho}{r}dv
\end{equation}
where $G$ is the gravitational constant and $r$ is the distance from an element of mass of volume $v$, with $dm = \rho dv$.

Common methods to do so are either \textit{spatial--domain} or \textit{spectral--domain} forward modelling methods \parencite{Kuhn2005}.

In spatial--domain methods, the direct integration of masses is computed: volumes are decomposed (\textit{discretised}) in elementary bodies for which a solution to the Newton integral exists.
There are analytical formulas available for special cases (e.g. point masses, prisms \cites{Nagy2000}{Nagy2002}, or polyhedra \cites{Tsoulis2012}), while numerical approximations are more commonly employed for general solutions \parencites[e.g. spherical tesseroids][]{Heck2006}{Uieda2016}.
Numerical methods, in addition, are less time consuming in equivalent cases, e.g. by resorting to FFT, Taylor series expansion, or Gauss--Legendre cubature \parencite[see][and references therein]{Grombein2013}.

Spectral--domain forward modelling, on the other hand, is based on the spherical harmonic (SH) series expansion of the Newtonian kernel \parencites{Rummel1988}{Blakely1996}{Root2015}{Wieczorek2007}.
In methods of this kind, coefficients of the resulting potential (or its derived functionals) are obtained from the mass distribution.
To assure convergence of the SH series, modelling is typically performed outside the \textit{Brillouin sphere}, i.e. a sphere encompassing all the field-generating mass, concentric with the spherical coordinate system \parencite{Moritz1980}.
Spectral--domain methods are commonly adopted for global computations, where they are considered less time consuming than spatial--domain methods, at least for degrees less than about 1000 \parencite{Kuhn2005}.
Computing higher maximum degrees of the SH series expansion, points inside the Brillouin sphere, and rugged topography are three factors that influence issues of numerical accuracy and divergence of spectral forward modelling methods \parencites{Hu2015}{Hirt2017}.
Combined spectral/spatial methods have been recently employed with success to obtain very high resolution synthetic gravity models \parencite{Hirt2019}.

The experiments described in this chapter were designed with the highest resolution available from satellite-only global gravity models, as gravity data to be reduced, and the resolution of global density models to compute reductions (as described in the following section~\ref{ss:SigIs:InModels}).
In addition, error assessment through random perturbation of the input models, the aforementioned Monte Carlo uncertainty propagation technique (described in section~\ref{ss:SigIs:Impl}), require a large number of forward iterations.
Therefore, I resorted to spectral--domain methods, using the method by \textcite{Wieczorek2007}, as implemented in the SHTOOLS code \parencite{Wieczorek2018}.

\Textcite{Wieczorek2007} provides a method for calculating the potential due to the topography, using a technique analogous to the cartesian (``flat-Earth'') method by \textcite{Parker1973}.
For its detailed description, I refer to the derivation of Eq.~6--12 in \textcite{Wieczorek1998}.
It is similar to a wider family of spherical-harmonics based solution to the volume integral, based on the binomial series expansion method, which \textcite{Root2015} defined as ``Fast Spectral Methods'' (FSMs).

Consider the case with a relief $h(\theta, \phi)$ ($\theta = \SI{90}{\degree} - \lambda$, colatitude), referenced to a spherical interface of radius $D$, with density $\rho(\theta, \phi)$ radially constant between $h$ and $D$, $\rho$ considered negative when $h<0$.
Expressing the potential $W$ at a reference radius $R_0$ as a sum of spherical harmonic functions, we get:
\begin{equation}
    \label{eq:SHfwd:pot}
    W(r, \lambda, \phi) =
    \frac{GM}{r}
    \sum_{l=0}^{l_{max}}
    \sum_{m=-l}^{l}
    \left( \frac{R_0}{r} \right)^l
    C_{lm} Y_{lm} (\lambda, \phi)
\end{equation}
where $G$ is the gravitational constant, $M$ the total mass, $r$ calculation radius, and $Y_{lm}$ denotes the real spherical harmonics:
\begin{equation}
    \label{eq:SHfwd:rsh}
    Y_{lm}(\lambda, \phi) =
    \begin{cases}
        \overline{P}_{lm} (cos \theta) \cos m \phi & \mbox{if } m \ge 0 \\
        \overline{P}_{l|m|} (cos \theta) sin |m| \phi & \mbox{if } m < 0
    \end{cases}
\end{equation}
with $P_{lm}$ the normalized associated Legendre polynomials, omitted here.
Note that this notation, which is the one that \textcite{Wieczorek2007} adopted, differs from the one more commonly used in geodesy and geophysics \parencite[e.g.][]{HofmannWellenhof2006}.
Here, the order-wise sum over $m$ (the innermost sum) is performed starting from $-l$.
This results in a more compact notation: the spherical harmonics coefficients are denoted only by $C_{lm}$, instead of the usual ``$C_{lm}$'' and ``$S_{lm}$''.
As defined by the two cases of Eq.~\ref{eq:SHfwd:rsh}, positive-order coefficients would be usually noted with $C_{lm}$ and negative-order ones would be usually noted with $S_{lm}$.

Therefore, the formula for $C_{lm}$, on which the forward modelling of the relief is based, can be expressed in this form \parencite{Wieczorek2007}:
\begin{equation}
    \label{eq:SHfwd:coeffs}
    C_{lm} =
    \frac{4 \pi D^3}{M(2l+1)}
    \sum_{n=1}^{l+3}
    \frac{(\rho h^n)_{lm}}{D^n \ n!}
    \frac{\prod_{j=1}^{n}(l+4-j)}{(l+3)}
\end{equation}
where the $(\rho h^n)_{lm}$ denotes the spherical harmonics of the relief times density, obtained from:
\begin{equation}
    \label{eq:SHfwd:reliefSH}
    (\rho h^n)_{lm} =
    \frac{1}{4 \pi}
    \int_{\theta, \phi}
    \left[ \rho(\theta, \phi) h^n(\theta, \phi) \right]
    Y_{lm}(\theta, \phi) d(\theta, \phi)
\end{equation}

Eq.~\ref{eq:SHfwd:coeffs} includes a Taylor series expansion of the power of the relief $(\rho h^n)_{lm}$.
If the sum is carried out up to its upper bound of the sum, $l+3$, it provides an exact solution.
However, the number of terms grows linearly with $l$.
Therefore, a truncation value $n_{max}$ is typically chosen, under the assumption that higher terms become more and more smaller \parencite{Wieczorek2007}.

However, \textcite{Balmino2012} and \textcite{Hirt2017} found that when a certain degree is reached, ``the energy of succeeding terms is larger than of the previous''.
They found this phenomenon to become significant around degree \num{1000} ---way above this experiment objective, which is limited by the maximum degree of satellite-only potential models (less than \num{300} as of March~2019).

The convergence of expansions of this kind has been rigorously studied by \textcite{Sun2001}, among others.
For a maximum degree $l = \num{360}$, a $n_{max}$ of \num{2} was shown to already provide less than \SI{1}{\percent} error ---in the case of topography.
Large deviations from the reference radius (e.g. in modelling deep layers) may result in convergence problems, which can be mitigated by reducing the reference radius accordingly, as it was shown later by \textcite{Root2015}.
For this reason, the experiments described in this section included a test against a spatial--domain benchmark.
It is described in detail in the following section, \ref{sss:SigIs:Fwd:LayerFwd}.

\Textcite{Wieczorek2007} notes that the potential (Eq.~\ref{eq:SHfwd:pot}) so obtained is valid only at $r > (D + h)$, i.e. outside the maximum radius of the relief ---this arises from the derivation of Eq.~\ref{eq:SHfwd:coeffs}, which is omitted here.

% accenno a ellipsoidal harmonics?
% trascurate qui - ne do il motivo?
% \Parencites{Claessens2013}{Rexer2016}

\subsubsection{Layer--wise modelling}
\label{sss:SigIs:Fwd:LayerFwd}
The forward modelling method by \Textcite{Wieczorek2007}, which was just described in section~\ref{sss:SigIs:Fwd:SHfwd}, provides the potential due to relief against a reference sphere.
In order to model the gravity effect of a \textit{layer}, I devised a strategy based on superposition of two relief-against-sphere potentials, which is described hereafter.
Defining a \textit{layer} as a volume of radially constant density $\rho(\lambda, \phi)$, bound by two surfaces expressed by geocentric radii $t(\lambda, \phi)$ and $b(\lambda, \phi)$, respectively top and bottom, its resulting potential ($W_{b}^{t}$) is equal to the following difference:
\begin{equation}
    \label{eq:layerFWD:layerPot}
    W_{b}^{t} = W_{b}^{D} - W_{top}^{D}
\end{equation}
where subscripts denote the bottom boundary, superscripts denote the top boundary and $D$ is the radius of the reference sphere (from Eq.~\ref{eq:SHfwd:coeffs}).
Therefore, the potential of a layer with two arbitrary bounding surfaces can be forward modelled by computing the difference between two relief referred to the same sphere, $W_{b}^{D}$ and $W_{t}^{D}$.
A graphical representation of this difference is shown in Fig.~\ref{fig:SigIs:LayerDifference}.

\begin{figure}
    \fbox{
    \begin{overpic}[width=0.9\textwidth]{SH_layer_superposition_out.pdf}
        \put (15,4) {\huge$W_{b}^{D}$}
        \put (45,4) {\huge$W_{t}^{D}$}
        \put (75,4) {\huge$W_{b}^{t}$}
    \end{overpic}}
    \caption{Sketch for the potential of a layer bounded by surfaces $b$ and $t$, as expressed in Eq.~\ref{eq:layerFWD:layerPot}.}
    \label{fig:SigIs:LayerDifference}
\end{figure}

A pitfall of this strategy is that Eq.~\ref{eq:SHfwd:pot} needs to be evaluated twice, including the series expansion of Eq.~\ref{eq:SHfwd:coeffs}.
Other strategies with a similar aim have been developed \parencite[e.g.][]{Novak2006} and avoid this issue.
Nevertheless, the implementation by \textcite{Wieczorek2018} was preferred here, since it could be readily integrated in the random modelling scheme --- their Fortran functions are provided as {F2PY}--wrapped Python modules \parencite{Peterson2009}.

\subsubsection{Spectral domain transform}
\label{sss:SigIs:Fwd:SHtransform}

Transforming a generic function $f$ in its spherical harmonic coefficients $f_{lm}$ goes under the name of Global Spherical Harmonic Analysis, GSHA \parencite{Sneeuw1994}.
It implies performing the following integration \parencite[Eq.~8 in][]{Wieczorek2007}:
\begin{equation}
    \label{eq:GSHA}
    f_{lm} =
    \frac{1}{4 \pi}
    \int_{\theta, \phi}
    f(\theta, \phi)
    Y_{lm}(\theta, \phi) d(\theta, \phi)
\end{equation}
which was already presented in Eq.~\ref{eq:SHfwd:reliefSH}, for the specific case of the relief-density product.
When $f$ is provided as a grid of discrete points, the integral of Eq.~\ref{eq:GSHA} can be evaluated numerically.
For these tests we utilised $n \times 2n$ grids (expressed as latitude times longitude) compliant to \textcite{Driscoll1994} sampling theorem.
Grids of these kind are also known as ``equally spaced''.
For such grids, the numerical solution to Eq.~\ref{eq:GSHA} is obtained through along--latitude FFT first, then by integration over latitude for each degree and order \parencites{Sneeuw1994}{Wieczorek2007}.
The transform on a $n \times 2n$ \textcite{Driscoll1994} grid is exact if $f$ is bandlimited to a maximum degree of $n/2 - 1$.

\subsubsection{Power spectrum and correlations between functions}
\label{sss:SigIs:Fwd:Spectrum}

For the degree $l$ of spherical harmonic coefficients $f_{lm}$, the \textit{degree variance} is defined as:
\begin{equation}
    \label{eq:DegVar}
    S_{ff}(l) = \sum_{m=-l}^{l} f_{lm}^2
\end{equation}
The degree variances spectrum, $S_{ff}(\bm{l})$ with $\bm{l} = (1, \dots, l_{max})$, provides a metric of the average power per harmonic degree \parencites{Rapp1982}{Wieczorek2007}{Hirt2015}.

Comparison between the coefficients of two functions, $f_{lm}$ and $g_{lm}$ may be performed by computing their cross-correlation:
\begin{equation}
    \label{eq:DegVarCross}
    S_{fg}(l) = \sum_{m=-l}^{l} \left( f_{lm} \enskip g_{lm} \right)
\end{equation}
Note that the cross-power spectrum $S_{fg}(\bm{l})$ obtained with this equation \parencite[Eq.~12 in][]{Wieczorek2007} differs from other common formulations \parencites[e.g.][]{Phillips1980}{Rapp1982}{Rexer2016} by a normalisation factor \sloppy{${[S_{ff}(l) \cdot S_{gg}(l)]^{-\frac{1}{2}}}$}, which was not applied here.

\subsubsection{Testing the method against spatial--domain forward modelling}
\label{sss:SigIs:Fwd:Test}
\Textcite{Sun2001}, assessing the convergence issues of spherical harmonics methods based on the binomial expansion, observed that isostatic studies require much higher truncation numbers than terrain forward modelling.
They argued that this arises due to the much larger differences between isostatic roots and the compensation depth (e.g. \SI{100}{\kilo \metre}), compared to topography and the reference radius (about \SI{9}{\kilo \metre} of maximum topography).
This issue was also addressed by \textcite{Root2015}, who proposed an improved \textit{fast spectral method} \parencites{Rummel1988}{Novak2006} in order to model crustal and upper mantle regions.
They devised an ``error mitigation strategy'' which consists in lowering the reference sphere to model the deeper layers, then transforming the spherical harmonics back to the usual, larger reference sphere.
By doing so, they obtain results inside a $\pm$~\SI{4}{\milli Gal} difference range from spatial--domain forward modelling.

Compared with the mean Earth radius ($R = \SI{6371}{\kilo \metre}$), a \SI{40}{\kilo \metre} deep crust--mantle boundary accounts for about 6 thousands of $R$.
When modelling the underlying lithospheric mantle, a \SI{300}{\kilo \metre} lithosphere--asthenosphere boundary reaches about \SI{4.7}{\percent} of $R$.
This means that the layers modelled in the following experiments are likely to incur in the issues that have been just described.

A rigorous assessment of the convergence of the layer--wise arrangement adopted in this work (section~\ref{sss:SigIs:Fwd:LayerFwd}) is not available at the moment.
Therefore, an heuristic test was devised to assess if such a strategy was fit for these experiments purpose, i.e. \si{\milli Gal} level accuracy at comparatively low degrees (limited by satellite-only gravity models).
As it is shown later, the magnitude of the contribution of uncertainty of geophysical models was large enough to support leaving any more rigorous analysis to further developments.

These tests consist of a direct comparison between the potential obtained from the layer--wise spectral--domain method and the one obtained from spatial--domain forward modelling, the latter being adopted as a benchmark.
Spatial--domain forward modelling was performed using the Tesseroids code \parencites{Uieda2016}{UiedaTesseroids}.

% descrizione test
% outcome test
% prova con degree maggiori?

% TEST DA FARE (DATI NUOVI!)
% effetto D "troppo lontano" con 4-5 D diversi
% sia con sintetico che con dati veri (es. LAB)

\subsection{Input mass distribution models}
\label{ss:SigIs:InModels}
% topografia, water, ice, litho, conversioni velocità
% descrizione e sistema riferimento (shape)

\subsubsection{Terrain correction}
\label{sss:SigIs:InModels:TC}
To model the solid topography, bathymetry (ocean, lakes) and ice, I adopted the {Earth2014} model \parencite{Hirt2015}.
It comprises data from SRTM (SRTM~v4.1 continental topography by \cite{Jarvis2008_SRTM4}, SRTM30~PLUS~v9 bathymetry by \cite{Becker_SRTM30plus}), Bedmap2 \parencite{Fretwell2013_Bedmap}, and GBT~v3 \parencite{Bamber2013_GBT}.
It is the base of the extensively used \verb|dV_ELL_Earth2014| topographic potential model \parencite{Rexer2016}.
In order to model an ellipsoid--referenced terrain correction (NETC, as described in section~\ref{sss:SigIs:Defs:NETC}) and to keep consistency with the subsurface stripping corrections applied afterwards, the already available potential model was not used.
Instead, I forward modelled and ad-hoc topographic potential, using {Earth2014} shape model (i.e. relief provided as geocentric radii) as input.

In addition to the spatial--domain comparison tests, shown in section~\ref{sss:SigIs:Fwd:Test}, the terrain correction proved an useful benchmark for troubleshooting the method implementation: it could be readily compared with other topographic model, which would have likely been more difficult with subsurface correction models.
Uncertainty propagation on the terrain correction was not among the objectives of these experiments, therefore it was not carried out.
However, this ad-hoc modelling setup would enable to do so easily, e.g. if required in further developments.

% formato in cui sono i dati, livelli, appunti da marzo

Potential forward modelling of the {Earth2014} relief grids was partitioned in solid topography, ocean bathymetry, lake bathymetry, on-shore ice, off-shore ice, and on-lakes ice.
\textit{Solid topography} is defined by the \verb|SUR| surface, the topmost surface in {Earth2014}, which includes the top surface of ice masses and of all bodies of water.
Top and bottom surfaces defining each layer are summarised in Table~\ref{tab:E2014fwdLayers}, along with their densities.
The general scheme of layers arrangement is sketched in Fig.~\ref{fig:E2014fwdLayersSketch}

% in questa subsubsection, RIMANGONO DA INSERIRE:
% - FIGURE RISULTATI, ISOLATE E SOMMATE
%       in frase in cui faccio riferimento a figure
%       spiego come sono state sommate
% - CONFRONTO CON dV_ELL? (è più roba da discussione)

\begin{table}[ht]
    \begin{adjustbox}{center}
    \begin{tabular}{lllrrr}
        \toprule   
        {} & \multicolumn{2}{c}{\textbf{Boundary surfaces}}  & \multicolumn{3}{c}{\textbf{Density [\si{\kilo \gram \per \cubic \metre}]}}\\
            \cmidrule{2-3}
            \cmidrule{4-6}
            \textbf{Layer name} & \multicolumn{1}{c}{\textbf{Top}} & \multicolumn{1}{c}{\textbf{Bottom}} & Layer & Ref. & Contrast \\
        \midrule
        Solid topography &
        \texttt{SUR} & \texttt{GRS80} &
        \num{2670} & & \\

        \textit{Stripping of} & & & & \\

        \quad ocean bathymetry &
        \texttt{SUR} & \texttt{BED\_OCEANS} &
        \num{1030} & \num{2670} & \num{-1640} \\

        \quad lake bathymetry &
        \texttt{SUR} & \texttt{BED\_LAKES} &
        \num{1000} & \num{2670} & \num{-1670} \\

        \quad on-shore ice &
        \texttt{TBI} & \texttt{ICEbot\_onshore} &
        \num{915} & \num{2670} & \num{-1755} \\

        \quad off-shore ice &
        \texttt{TBI} & \texttt{ICEbot\_offshore} &
        \num{915} & \num{1030} & \num{-1755} \\

        \quad on-lakes ice &
        \texttt{TBI} & \texttt{ICEbot\_onlakes} &
        \num{915} & \num{1000} & \num{-1755} \\
        \bottomrule
    \end{tabular}
    \end{adjustbox}
    \caption{
        Terrain correction scheme: summary of the layers and their defining surfaces and densities.
        \textit{Layer:}~density of the modelled mass.
        \textit{Ref.:}~reference density for stripping corrections.
        \textit{Contrast.:}~layer density minus reference density.
        For a description of the surfaces, see Tab.~\ref{tab:E2014fwdSurfaces}.}
    \label{tab:E2014fwdLayers}
\end{table}

\begin{table}[ht]
    \begin{adjustbox}{center}
    \begin{tabular}{ll}
        \toprule   
        \textbf{Surface} & \textbf{Description} \\
        \midrule
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{AAA} &
        Placeholder placeholder placeholder placeholder. \\
        \texttt{BOT} &
        Note: all-out bottom HERE, used as datum for {LITHO1.0}. \\
        \bottomrule
    \end{tabular}
    \end{adjustbox}
    \caption{Description of the input surfaces utilised in the terrain correction, as extracted from Earth2014 \parencite{Hirt2015}.}
    \label{tab:E2014fwdSurfaces}
\end{table}

\begin{figure}
    \fbox{
        \Huge{\texttt{placeholder: layers sketch}}
    }
        \caption{Temp caption.}
        \label{fig:E2014fwdLayersSketch}
\end{figure}

\subsubsection{Sediments and crust}
\label{sss:SigIs:InModels:CRUST}

%\parencite{Laske2012Crust10}
%\parencite{Pasyanos2014}

\subsubsection{Lithospheric mantle}
\label{sss:SigIs:InModels:SCLM}

%\parencite{Connolly2005}
%\parencite{Connolly2009}

\newpage % remove later
\subsection{Assessment of uncertainty}
\label{ss:SigIs:Impl}
% multiprocessing

% spostati commenti seguenti da FWD
% razionale per il metodo: random modelling

\subsection{Global reduction results}
\label{ss:SigIs:Results}
% con valutazioni spettrali

\subsubsection{Discussion}
\label{ss:SigIs:Results:Discussion}
% confronto con tenzer2009 (e 2015)
% statico-no-uncertainty
% a strati (con ancora segnale ondulazione)
% vs "a gusci"
% esempio taglio a massima profondità Moho
% v. appunti 20190821

% considerazioni su input bandwidth: sposto a discussione
% for in detail, reader is referred to Hirt and Kuhn 2017
% "While the topography mass models are strictly band-limited to the NT max values reported in Table 1, the topography-implied gravity contains signals at harmonic degrees much larger than NT max" [Hirt and Kuhn, 2014]



% questioni numeriche: pag. 24 di Root (2015)
% faccio doppio calcolo per coefficienti (con sovrapposizione)
% di contro, rispetto a Novak, faccio singolo rho*h in spatial domain
% risparmiandomi una GSHA (SH analysis grid->SH), che è expensive
% implementazione nello script: GSHA per interfacce fatta il doppio
% perché ne faccio una sia per il bottom dello strato sopra
% che per il top dello strato sotto

\input{../0000_chapter_draft_boilerplate/phdt_0000_draft_boilerplate_end.tex}
